

# 비트코인



## 지갑

비트코인 지갑에는 비트코인이 있는것이 아닌 키값들이 들어있다. 
키는 개인키(비밀키), 공개키 쌍으로 구성됨

비밀키에 타원곡선 곱셈 함수를 하면 공개키를 구할 수 있고
공개키를 해쉬 함수를 통해 계산하면 비트코인 주소가 생성된다. 
역방향으로 계산은 불가능하다. 

![img](https://t1.daumcdn.net/cfile/tistory/99BD14485A9930AC12)



**비밀키 생성**

1 ~ 2의 256승 사이 값을 랜덤하게 추출



**공개키 생성**

K = k * G
공개키는 비밀키에 생성포인트(G)를 사용하여 생성한다. 생성포인트는 고정된 값이며 비밀키를 통해 고유한 공개키를 생성 할 수 있다. 



**주소 생성**

공개키를 sha256, ripemd 160 이라는 해쉬함수를 통해 해쉬값(160비트)을 얻고
base58check로 인코딩하여 (20글자) 사용한다.

![ë¹í¸ì½ì¸ ì§ê° checksumì ëí ì´ë¯¸ì§ ê²ìê²°ê³¼](https://1.bp.blogspot.com/-5z1iMUbuGu0/WorGCRxVEQI/AAAAAAAAAdM/NHx2N70wj48pl1gINoInPtYy-VTFNI68gCLcBGAs/s1600/mbc2_0405.png)



base58 인코딩은 해쉬값에 앞부분에 version을 뒷부분에 checksum값을 넣고 인코딩한다. 
checksum은 앞부분의 내용이 올바른지 올바르지 않은지 검사하는 부분이다. 
**간단하게 주소의 유효성을 검사하기 위해서는 해당 checksum이 올바른 값인지 체크 할 수 있다.** 

![ë¹í¸ì½ì¸ ì§ê° checksumì ëí ì´ë¯¸ì§ ê²ìê²°ê³¼](https://steemitimages.com/640x0/https://1.bp.blogspot.com/-xSi-IyLua6o/WorIZ5I1EtI/AAAAAAAAAdg/zqwVMBS58MgQj1aOmxSYQ4afrKuBhhezwCLcBGAs/s640/mbc2_0406.png)



### 지갑의 종류

1. 비결정적 지갑
2. 결정적 지갑
3. 계층 결정적 지갑



### 비결정적 지갑

여러개의 키 사이에 규칙이나 연속성이 없이 무작위로 생성된 키쌍이 존재
예를 들어 지갑이 생성될때 100개의 개인키를 무작위로 생성하여 사용하고 이후 모든키가 사용된후에 다시 무작위로 새로운 키를 생성됨
주기적으로 지갑의 모든키를 백업해야함



### 결정적 지갑

랜덤하게 발생된 Common Seed 에서 단방향 Hash 함수를 통해서  개인키를 연속적으로 생성
Common Seed만 알고 있다면 연속된 모든 개인키를 복원할수 있음

![img](https://t1.daumcdn.net/cfile/tistory/9983CD435A9A19D61F)



### 계층 결정적 지갑

HD지갑은 128,256,512비트 크기의 Root seed로부터 만들어지며, HMAC-SHA512 알고리즘을 통해 마스터 개인키와 마스터 체인코드를 생성

![img](https://t1.daumcdn.net/cfile/tistory/9918BB455A9A4F4827)



# 체크해야할 항목

- [ ] 키값 생성을 어떻게 이루어지는가
  지갑에서 키 값이 생성되면 바로 사용 가능한 것인가? 해당 키를 블록체인에 올려 내꺼라는 등록을 해야하므로 시간이 걸리는 것인가? 
- [ ] bitgo에서는 지갑을 생성하면 바로 사용 가능하던데 
  키값을 블록체인에 올려 등록하는 행위가 필요하면 bitgo에서 제공하는 주소들은 미리 만들어진 주소인지 그때그때 만드는 주소인지
- [ ] 지갑에서 키값 생성이 바로 되면 
    비밀키는 갯수가 엄청 많으니 절대 같은값을 사용하지 못한다는 전제하에 
    비트코인 송금은 주소의 checksum값만 맞으면 보내진다고 가정 
    A라는 사람이 B라는 주인이 없는 주소에 1BTC를 송금하고 
    C라는 사람이 시간이 지나 우연히 B라는 주소를 생성하면 1BTC를 가지고 있는것인지
- [x] 지갑에 주소는 몇개까지 생성이 가능한가?
    => bitgo에서는 무한히 만들 수 있다고함



위 항목들이 정리되면 지갑 생성을 API로 바로 할 것인지, 
뱅크러시처럼 미리 여러개 생성 해 두고 사용할 것인지 방향을 정할 수 있음



질문. https://bitcoin.stackexchange.com/questions/90160/about-bitcoin-address

- 비트코인 송금 시 주소를 잘못 입력하면?
  - 포맷을 잘못 입력한 경우
  - 우연히 포맷은 맞으나 아무도 사용하지 않는 주소
    - 전송된다고하면 후에 A라는 사람이 우연히 해당 주소를 가졌을 경우 전송된 금액은 A의 balance가 되는지? 